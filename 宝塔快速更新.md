# 宝塔面板快速更新 - 3步搞定

## 🎯 更新内容

添加了**账号限额自动获取功能**，新增账号时自动从皇冠网站获取限额。

## ⚡ 快速更新（3步）

### 第1步：打开宝塔终端

**方式A：从左侧菜单打开**
1. 登录宝塔面板
2. 点击左侧菜单 **"终端"** 或 **"SSH终端"**

**方式B：从文件管理器打开**
1. 登录宝塔面板
2. 点击左侧菜单 **"文件"**
3. 导航到 `/www/wwwroot/aibcbot.top`
4. 点击顶部 **"终端"** 按钮

### 第2步：进入项目目录

在终端中输入：
```bash
cd /www/wwwroot/aibcbot.top
```

### 第3步：运行更新脚本

在终端中输入：
```bash
bash server-update.sh
```

**完成！** 等待脚本自动完成所有更新步骤（约2-3分钟）。

## 📋 更新过程中会看到什么

```
==========================================
  服务器更新脚本 - 限额自动获取功能
==========================================

📁 项目目录: /www/wwwroot/aibcbot.top

1️⃣  备份当前代码...
✓ 备份完成: backup-20251028-143000.tar.gz

2️⃣  检查 Git 状态...
✓ Git 仓库存在
当前版本: 2969eac docs: 添加部署和更新指南

3️⃣  拉取最新代码...
✓ 代码更新成功
新版本: 64ddbb5 feat: 添加服务器专用更新脚本和指南

4️⃣  更新后端...
   安装依赖...
✓ 后端依赖安装成功
   编译代码...
✓ 后端编译成功

5️⃣  重启后端服务...
✓ 后端服务重启成功

6️⃣  更新前端...
   安装依赖...
✓ 前端依赖安装成功
   构建前端...
✓ 前端构建成功

7️⃣  重启 Nginx...
✓ Nginx 重启成功

8️⃣  运行功能测试...
🧪 开始测试限额获取功能...
✅ 登录成功
✅ 限额页面获取成功
✅ 找到足球限额表格
✅ 找到篮球限额表格
✅ 测试完成！限额获取功能正常工作

9️⃣  查看服务状态...
[显示 PM2 进程列表]

🔟 查看最近日志...
[显示最近20行日志]

==========================================
✅ 服务器更新完成！
==========================================

🌐 访问地址:
  https://aibcbot.top

🎉 现在可以使用新功能了！
```

## ✅ 验证更新

### 快速验证

1. 打开浏览器访问 **https://aibcbot.top**
2. 登录系统
3. 进入"账号管理"
4. 点击"添加账号"
5. 填写账号信息并保存
6. 看到提示："限额信息已自动获取并保存" ✅

### 详细验证

在宝塔终端中执行：
```bash
cd /www/wwwroot/aibcbot.top/backend
node backend/test-fetch-limits.js
```

## 🔍 查看服务状态

### 方式1：使用宝塔面板

1. 点击 **"软件商店"**
2. 找到 **"PM2管理器"**
3. 点击 **"设置"**
4. 查看 `bclogin-backend` 状态

### 方式2：使用命令

在宝塔终端中执行：
```bash
/www/server/nodejs/v22.18.0/bin/pm2 status
```

## 📱 使用宝塔手机APP更新

1. 打开宝塔APP
2. 选择服务器
3. 点击 **"终端"**
4. 输入：
   ```bash
   cd /www/wwwroot/aibcbot.top && bash server-update.sh
   ```

## 🐛 遇到问题？

### 问题1：提示 "bash: server-update.sh: No such file or directory"

**原因**：还没有拉取最新代码

**解决**：
```bash
cd /www/wwwroot/aibcbot.top
git pull origin main
bash server-update.sh
```

### 问题2：提示 "git: command not found"

**原因**：服务器没有安装 Git

**解决**：
1. 在宝塔面板点击 **"软件商店"**
2. 搜索 **"Git"**
3. 点击 **"安装"**

### 问题3：PM2 重启失败

**解决**：
1. 在宝塔面板点击 **"软件商店"**
2. 找到 **"PM2管理器"**
3. 点击 **"设置"**
4. 找到 `bclogin-backend`
5. 点击 **"重启"**

### 问题4：更新后功能不正常

**解决**：
1. 查看日志：
   - 在宝塔面板 → 软件商店 → PM2管理器 → 日志
2. 或者在终端执行：
   ```bash
   /www/server/nodejs/v22.18.0/bin/pm2 logs bclogin-backend --lines 50
   ```

## 🔄 如果需要回滚

在宝塔终端中执行：
```bash
cd /www/wwwroot/aibcbot.top
git reset --hard b199e02
cd backend && npm run build
/www/server/nodejs/v22.18.0/bin/pm2 restart bclogin-backend
```

## 🎯 新功能说明

### 自动获取限额

**以前**：添加账号后需要手动输入限额

**现在**：添加账号后自动从皇冠网站获取限额 ⭐

### 使用方法

1. 进入"账号管理"
2. 点击"添加账号"
3. 填写账号信息（用户名、密码等）
4. 点击"确定"
5. **系统自动获取限额** ✨
6. 显示成功消息

### 手动更新限额

如果需要更新已有账号的限额：
1. 编辑账号
2. 切换到"限额设置"标签
3. 点击"获取限额"按钮
4. 自动填充最新限额

## 📞 需要帮助？

查看详细文档：
- **宝塔更新指南.md** - 完整的宝塔操作指南
- **QUICK_REFERENCE_LIMITS.md** - 快速参考
- **SERVER_CONFIG.md** - 服务器配置信息

## 🎉 总结

**更新只需3步**：
1. 打开宝塔终端
2. 进入项目目录：`cd /www/wwwroot/aibcbot.top`
3. 运行更新脚本：`bash server-update.sh`

**就这么简单！** 🚀

---

**更新日期**: 2025-10-28  
**访问地址**: https://aibcbot.top  
**测试账号**: zhuren / 123456

