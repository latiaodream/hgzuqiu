# æ™ºæŠ•ç³»ç»Ÿ - å®Œæ•´é¡¹ç›®æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
3. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
6. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
7. [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®åç§°
**æ™ºæŠ•ç³»ç»Ÿ - çš‡å† è¶³çƒä¸‹æ³¨ç®¡ç†å¹³å°**

### é¡¹ç›®ç®€ä»‹
æ™ºæŠ•ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¸“ä¸šçš„çš‡å† è¶³çƒåšå½©ç®¡ç†å¹³å°ï¼Œæä¾›è´¦å·ç®¡ç†ã€èµ›äº‹æŠ“å–ã€è‡ªåŠ¨ä¸‹æ³¨ã€ç»“ç®—åŒæ­¥ã€é‡‘å¸æµæ°´ç­‰å®Œæ•´åŠŸèƒ½ã€‚ç³»ç»Ÿæ”¯æŒå¤šçº§ç”¨æˆ·æƒé™ç®¡ç†ï¼ˆç®¡ç†å‘˜ã€ä»£ç†ã€å‘˜å·¥ï¼‰ï¼Œå®ç°äº†ä»èµ›äº‹æ•°æ®è·å–åˆ°ä¸‹æ³¨ç»“ç®—çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- **è´¦å·ç®¡ç†**ï¼šç®¡ç†çš‡å† å¹³å°è´¦å·ï¼Œæ”¯æŒä»£ç†åˆ†é…ã€è®¾å¤‡é…ç½®ã€é™é¢è®¾ç½®
- **èµ›äº‹ç®¡ç†**ï¼šè‡ªåŠ¨æŠ“å–çš‡å† å¹³å°èµ›äº‹æ•°æ®å’Œå®æ—¶èµ”ç‡
- **æ™ºèƒ½ä¸‹æ³¨**ï¼šæ”¯æŒæ‰¹é‡ä¸‹æ³¨ã€é—´éš”ä¸‹æ³¨ã€èµ”ç‡æ§åˆ¶
- **ç»“ç®—åŒæ­¥**ï¼šè‡ªåŠ¨åŒæ­¥ä¸‹æ³¨ç»“æœå’Œç›ˆäºæ•°æ®
- **é‡‘å¸ç³»ç»Ÿ**ï¼šè™šæ‹Ÿé‡‘å¸ç®¡ç†ï¼Œç”¨äºæƒé™æ§åˆ¶å’Œæˆæœ¬æ ¸ç®—
- **æ•°æ®çœ‹æ¿**ï¼šå®æ—¶ç»Ÿè®¡ä¸‹æ³¨æ•°æ®ã€ç›ˆäºåˆ†æã€å›æŠ¥ç‡è®¡ç®—
- **æƒé™ç®¡ç†**ï¼šä¸‰çº§æƒé™ä½“ç³»ï¼ˆadmin/agent/staffï¼‰

### ä¸šåŠ¡æµç¨‹
1. **ç®¡ç†å‘˜**åˆ›å»ºä»£ç†è´¦å·ï¼Œåˆ†é…é‡‘å¸é¢åº¦
2. **ä»£ç†**åˆ›å»ºå‘˜å·¥è´¦å·ï¼Œæ·»åŠ çš‡å† è´¦å·åˆ°è´¦å·æ± 
3. **å‘˜å·¥**é€‰æ‹©èµ›äº‹å’Œç›˜å£ï¼Œè®¾ç½®ä¸‹æ³¨å‚æ•°
4. **ç³»ç»Ÿ**è‡ªåŠ¨æ‰§è¡Œä¸‹æ³¨ä»»åŠ¡ï¼Œæ¶ˆè€—é‡‘å¸
5. **ç³»ç»Ÿ**å®šæ—¶åŒæ­¥ç»“ç®—ç»“æœï¼Œæ›´æ–°ç›ˆäºæ•°æ®
6. **ç”¨æˆ·**æŸ¥çœ‹æ•°æ®çœ‹æ¿ï¼Œåˆ†ææŠ•æ³¨æ•ˆæœ

---

## æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **è¿è¡Œç¯å¢ƒ**ï¼šNode.js v22.18.0
- **å¼€å‘è¯­è¨€**ï¼šTypeScript 5.9.2
- **Webæ¡†æ¶**ï¼šExpress 5.1.0
- **æ•°æ®åº“**ï¼šPostgreSQL 14+
- **æ•°æ®åº“å®¢æˆ·ç«¯**ï¼špg 8.16.3
- **èº«ä»½è®¤è¯**ï¼šJWT (jsonwebtoken 9.0.2)
- **å¯†ç åŠ å¯†**ï¼šbcrypt 6.0.0
- **HTTPå®¢æˆ·ç«¯**ï¼šaxios 1.12.2
- **å®šæ—¶ä»»åŠ¡**ï¼šcron 4.3.3
- **æ—¥æœŸå¤„ç†**ï¼šdayjs 1.11.18
- **XMLè§£æ**ï¼šxml2js 0.6.2, fast-xml-parser 5.3.0
- **ä»£ç†æ”¯æŒ**ï¼šhttps-proxy-agent 7.0.6, socks-proxy-agent 8.0.5
- **è¿›ç¨‹ç®¡ç†**ï¼šPM2

### å‰ç«¯æŠ€æœ¯
- **å¼€å‘è¯­è¨€**ï¼šTypeScript 5.8.3
- **UIæ¡†æ¶**ï¼šReact 18.3.1
- **æ„å»ºå·¥å…·**ï¼šVite 7.1.7
- **UIç»„ä»¶åº“**ï¼šAnt Design 5.27.4
- **è·¯ç”±ç®¡ç†**ï¼šReact Router DOM 6.28.0
- **HTTPå®¢æˆ·ç«¯**ï¼šaxios 1.12.2
- **æ—¥æœŸå¤„ç†**ï¼šdayjs 1.11.18
- **å›¾æ ‡åº“**ï¼š@ant-design/icons 5.3.7

### æœåŠ¡å™¨ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 22.04.5 LTS
- **WebæœåŠ¡å™¨**ï¼šNginx
- **è¿›ç¨‹ç®¡ç†**ï¼šPM2
- **æœåŠ¡å™¨IP**ï¼š47.238.112.207
- **åŸŸå**ï¼šhttps://aibcbot.top

---

## ç³»ç»Ÿæ¶æ„

### ç›®å½•ç»“æ„
```
bclogin-system/
â”œâ”€â”€ backend/                    # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app.ts             # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ database.ts    # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ routes/            # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts        # è®¤è¯æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ accounts.ts    # è´¦å·ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ agents.ts      # ä»£ç†ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ staff.ts       # å‘˜å·¥ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ matches.ts     # èµ›äº‹ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ bets.ts        # ä¸‹æ³¨è®°å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ coins.ts       # é‡‘å¸æµæ°´
â”‚   â”‚   â”‚   â”œâ”€â”€ crown-sites.ts # ç«™ç‚¹ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ crown-automation.ts # çš‡å† è‡ªåŠ¨åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ account-shares.ts   # è´¦å·å…±äº«
â”‚   â”‚   â”‚   â””â”€â”€ groups.ts      # åˆ†ç»„ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ types/             # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ migrations/            # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ dist/                  # ç¼–è¯‘è¾“å‡º
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ frontend/                   # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.tsx           # åº”ç”¨å…¥å£
â”‚   â”‚   â”œâ”€â”€ App.tsx            # æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ App.css            # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ pages/             # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardPage.tsx    # æ•°æ®çœ‹æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ AccountsPage.tsx     # è´¦å·ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentsPage.tsx       # ä»£ç†ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ StaffPage.tsx        # å‘˜å·¥ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ MatchesPage.tsx      # èµ›äº‹ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ BettingPage.tsx      # ä¸‹æ³¨è®°å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ CoinsPage.tsx        # é‡‘å¸æµæ°´
â”‚   â”‚   â”‚   â”œâ”€â”€ CrownSitesPage.tsx   # ç«™ç‚¹ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ FetchAccountsPage.tsx # èµ›äº‹æŠ“å–è´¦å·
â”‚   â”‚   â”‚   â”œâ”€â”€ SettingsPage.tsx     # ä¸ªäººä¸­å¿ƒ
â”‚   â”‚   â”‚   â””â”€â”€ AuthPage.tsx         # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/        # ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout/        # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Auth/          # è®¤è¯ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Accounts/      # è´¦å·ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ Betting/       # ä¸‹æ³¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ services/          # APIæœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts         # APIå®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â””â”€â”€ accountShareApi.ts # è´¦å·å…±äº«API
â”‚   â”‚   â”œâ”€â”€ contexts/          # React Context
â”‚   â”‚   â”‚   â””â”€â”€ AuthContext.tsx # è®¤è¯ä¸Šä¸‹æ–‡
â”‚   â”‚   â”œâ”€â”€ types/             # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ dist/                  # æ„å»ºè¾“å‡º
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ database/                   # æ•°æ®åº“è„šæœ¬
â”‚   â”œâ”€â”€ schema.sql             # æ•°æ®åº“ç»“æ„
â”‚   â””â”€â”€ migrations/            # è¿ç§»è„šæœ¬
â”‚
â””â”€â”€ PROJECT_DOCUMENTATION.md   # é¡¹ç›®æ–‡æ¡£
```

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  ç®¡ç†å‘˜  â”‚  â”‚   ä»£ç†   â”‚  â”‚   å‘˜å·¥   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â–¼          å‰ç«¯å±‚                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  React + TypeScript + Ant Design + Vite             â”‚ â”‚
â”‚  â”‚  - æ•°æ®çœ‹æ¿  - è´¦å·ç®¡ç†  - èµ›äº‹ç®¡ç†  - ä¸‹æ³¨è®°å½•     â”‚ â”‚
â”‚  â”‚  - ä»£ç†ç®¡ç†  - å‘˜å·¥ç®¡ç†  - é‡‘å¸æµæ°´  - ç«™ç‚¹ç®¡ç†     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTPS/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â–¼          åç«¯å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Express + TypeScript + JWT                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚  â”‚ è®¤è¯ä¸­é—´ä»¶ â”‚  â”‚ æƒé™æ§åˆ¶   â”‚  â”‚ é”™è¯¯å¤„ç†   â”‚     â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚              APIè·¯ç”±å±‚                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  /auth  /accounts  /matches  /bets  /coins    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚              ä¸šåŠ¡æœåŠ¡å±‚                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - çš‡å† è‡ªåŠ¨åŒ–æœåŠ¡  - èµ›äº‹åŒæ­¥æœåŠ¡             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - ä¸‹æ³¨æ‰§è¡ŒæœåŠ¡    - ç»“ç®—åŒæ­¥æœåŠ¡             â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - é‡‘å¸ç®¡ç†æœåŠ¡    - å®šæ—¶ä»»åŠ¡æœåŠ¡             â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ PostgreSQL Protocol
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â–¼          æ•°æ®å±‚                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL 14+                                      â”‚  â”‚
â”‚  â”‚  - users (ç”¨æˆ·è¡¨)                                    â”‚  â”‚
â”‚  â”‚  - crown_accounts (çš‡å† è´¦å·è¡¨)                       â”‚  â”‚
â”‚  â”‚  - matches (èµ›äº‹è¡¨)                                  â”‚  â”‚
â”‚  â”‚  - bets (ä¸‹æ³¨è®°å½•è¡¨)                                 â”‚  â”‚
â”‚  â”‚  - coin_transactions (é‡‘å¸æµæ°´è¡¨)                   â”‚  â”‚
â”‚  â”‚  - groups (åˆ†ç»„è¡¨)                                   â”‚  â”‚
â”‚  â”‚  - settings (è®¾ç½®è¡¨)                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â–¼          å¤–éƒ¨æœåŠ¡                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  çš‡å† å¹³å° API                                        â”‚  â”‚
â”‚  â”‚  - èµ›äº‹æ•°æ®æ¥å£  - èµ”ç‡æ•°æ®æ¥å£                     â”‚  â”‚
â”‚  â”‚  - ä¸‹æ³¨æ¥å£      - ç»“ç®—æŸ¥è¯¢æ¥å£                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®åº“è®¾è®¡

### æ•°æ®åº“è¿æ¥é…ç½®
```env
DB_HOST=127.0.0.1
DB_PORT=5432
DB_NAME=hgzuqiu
DB_USER=hgzuqiu
DB_PASSWORD=AbDN22pKhcsNnJSk
```

### è¡¨ç»“æ„è¯¦è§£

#### 1. users - ç”¨æˆ·è¡¨
å­˜å‚¨ç³»ç»Ÿç”¨æˆ·ä¿¡æ¯ï¼Œæ”¯æŒä¸‰çº§æƒé™ä½“ç³»ã€‚

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | SERIAL | PRIMARY KEY | ç”¨æˆ·IDï¼Œè‡ªå¢ä¸»é”® |
| username | VARCHAR(50) | UNIQUE NOT NULL | ç”¨æˆ·åï¼Œå”¯ä¸€ |
| email | VARCHAR(100) | UNIQUE NOT NULL | é‚®ç®±ï¼Œå”¯ä¸€ |
| password_hash | VARCHAR(255) | NOT NULL | å¯†ç å“ˆå¸Œå€¼ï¼ˆbcryptåŠ å¯†ï¼‰ |
| role | VARCHAR(20) | NOT NULL DEFAULT 'staff' | è§’è‰²ï¼šadminï¼ˆç®¡ç†å‘˜ï¼‰ã€agentï¼ˆä»£ç†ï¼‰ã€staffï¼ˆå‘˜å·¥ï¼‰ |
| parent_id | INTEGER | REFERENCES users(id) | ä¸Šçº§ç”¨æˆ·IDï¼Œç”¨äºå±‚çº§å…³ç³» |
| agent_id | INTEGER | REFERENCES users(id) | æ‰€å±ä»£ç†IDï¼Œå‘˜å·¥å…³è”åˆ°ä»£ç† |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**æƒé™è¯´æ˜**ï¼š
- **admin**ï¼šè¶…çº§ç®¡ç†å‘˜ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ•°æ®ï¼Œç®¡ç†æ‰€æœ‰ç”¨æˆ·
- **agent**ï¼šä»£ç†ï¼Œå¯ä»¥åˆ›å»ºå‘˜å·¥ï¼ŒæŸ¥çœ‹è‡ªå·±å’Œä¸‹å±å‘˜å·¥çš„æ•°æ®
- **staff**ï¼šå‘˜å·¥ï¼Œåªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•°æ®

**ç´¢å¼•**ï¼š
- `idx_users_role` ON (role)
- `idx_users_parent_id` ON (parent_id)
- `idx_users_agent_id` ON (agent_id)

#### 2. groups - åˆ†ç»„è¡¨
ç”¨äºç»„ç»‡å’Œç®¡ç†çš‡å† è´¦å·çš„åˆ†ç»„ã€‚

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | SERIAL | PRIMARY KEY | åˆ†ç»„IDï¼Œè‡ªå¢ä¸»é”® |
| user_id | INTEGER | NOT NULL REFERENCES users(id) | æ‰€å±ç”¨æˆ·ID |
| name | VARCHAR(100) | NOT NULL | åˆ†ç»„åç§° |
| description | TEXT | | åˆ†ç»„æè¿° |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

#### 3. crown_accounts - çš‡å† è´¦å·è¡¨
å­˜å‚¨çš‡å† å¹³å°è´¦å·çš„å®Œæ•´ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç™»å½•å‡­è¯ã€è´¢åŠ¡ä¿¡æ¯ã€è®¾å¤‡é…ç½®ã€ä»£ç†è®¾ç½®ç­‰ã€‚

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| **åŸºæœ¬ä¿¡æ¯** |
| id | SERIAL | PRIMARY KEY | è´¦å·IDï¼Œè‡ªå¢ä¸»é”® |
| user_id | INTEGER | NOT NULL REFERENCES users(id) | æ‰€å±ç”¨æˆ·ID |
| group_id | INTEGER | NOT NULL REFERENCES groups(id) | æ‰€å±åˆ†ç»„ID |
| username | VARCHAR(100) | NOT NULL | çš‡å† è´¦å·ç”¨æˆ·å |
| password | VARCHAR(255) | NOT NULL | çš‡å† è´¦å·å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰ |
| passcode | VARCHAR(20) | | å››ä½ç®€æ˜“ç™»å½•å¯†ç  |
| display_name | VARCHAR(100) | | æ˜¾ç¤ºåç§°ï¼Œå¦‚ï¼šG1aokloz (cfax5g2hoz) |
| original_username | VARCHAR(100) | | åŸå§‹è´¦å·ï¼ˆé¦–æ¬¡ç™»å½•æ—¶çš„è´¦å·ï¼‰ |
| initialized_username | VARCHAR(100) | | ä¿®æ”¹åçš„è´¦å·ï¼ˆåˆå§‹åŒ–åä½¿ç”¨çš„è´¦å·ï¼‰ |
| **å¹³å°ä¿¡æ¯** |
| platform | VARCHAR(50) | DEFAULT 'çš‡å† ' | å¹³å°åç§° |
| game_type | VARCHAR(50) | DEFAULT 'è¶³çƒ' | æ¸¸æˆç±»å‹ï¼šè¶³çƒã€ç¯®çƒç­‰ |
| source | VARCHAR(50) | DEFAULT 'è‡ªæœ‰' | æ¥æºï¼šè‡ªæœ‰ã€å…±äº« |
| share_count | INTEGER | DEFAULT 0 | åˆ†äº«æ•°é‡ |
| **è´¢åŠ¡ä¿¡æ¯** |
| currency | VARCHAR(10) | DEFAULT 'CNY' | å¸ç§ï¼šCNYã€USDç­‰ |
| discount | DECIMAL(3,2) | DEFAULT 1.00 | æŠ˜æ‰£ç‡ï¼š0.8ã€0.85ã€1.0 |
| note | VARCHAR(50) | | å¤‡æ³¨ï¼šé«˜ã€ä¸­ã€ä½ |
| balance | DECIMAL(15,2) | DEFAULT 0 | è´¦å·ä½™é¢ |
| stop_profit_limit | DECIMAL(15,2) | DEFAULT 0 | æ­¢ç›ˆé‡‘é¢ |
| **è®¾å¤‡ä¿¡æ¯** |
| device_type | VARCHAR(50) | | è®¾å¤‡ç±»å‹ï¼šiPhone 14ã€iPhone 15ã€iPhone 11 |
| user_agent | TEXT | | ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ï¼Œç”¨äºæ¨¡æ‹Ÿè®¾å¤‡ |
| **ä»£ç†ä¿¡æ¯** |
| proxy_enabled | BOOLEAN | DEFAULT false | æ˜¯å¦å¯ç”¨ä»£ç† |
| proxy_type | VARCHAR(10) | | ä»£ç†ç±»å‹ï¼šhttpã€socks5 |
| proxy_host | VARCHAR(255) | | ä»£ç†æœåŠ¡å™¨åœ°å€ |
| proxy_port | INTEGER | | ä»£ç†æœåŠ¡å™¨ç«¯å£ |
| proxy_username | VARCHAR(100) | | ä»£ç†è®¤è¯ç”¨æˆ·å |
| proxy_password | VARCHAR(255) | | ä»£ç†è®¤è¯å¯†ç  |
| **å½’å±ä¿¡æ¯** |
| agent_id | INTEGER | REFERENCES users(id) | æ‰€å±ä»£ç†ID |
| use_for_fetch | BOOLEAN | DEFAULT false | æ˜¯å¦ç”¨äºèµ›äº‹æŠ“å– |
| **é™é¢è®¾ç½®** |
| football_prematch_limit | DECIMAL(15,2) | DEFAULT 100000 | è¶³çƒèµ›å‰å•ç¬”é™é¢ |
| football_live_limit | DECIMAL(15,2) | DEFAULT 100000 | è¶³çƒæ»šçƒå•ç¬”é™é¢ |
| basketball_prematch_limit | DECIMAL(15,2) | DEFAULT 100000 | ç¯®çƒèµ›å‰å•ç¬”é™é¢ |
| basketball_live_limit | DECIMAL(15,2) | DEFAULT 100000 | ç¯®çƒæ»šçƒå•ç¬”é™é¢ |
| **çŠ¶æ€ç®¡ç†** |
| is_enabled | BOOLEAN | DEFAULT true | æ˜¯å¦å¯ç”¨ |
| is_online | BOOLEAN | DEFAULT false | æ˜¯å¦åœ¨çº¿ |
| last_login_at | TIMESTAMP | | æœ€åç™»å½•æ—¶é—´ |
| status | VARCHAR(20) | DEFAULT 'active' | çŠ¶æ€ï¼šactiveï¼ˆæ­£å¸¸ï¼‰ã€disabledï¼ˆç¦ç”¨ï¼‰ã€errorï¼ˆé”™è¯¯ï¼‰ |
| error_message | TEXT | | é”™è¯¯ä¿¡æ¯ |
| **æ—¶é—´æˆ³** |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- `idx_crown_accounts_user_id` ON (user_id)
- `idx_crown_accounts_group_id` ON (group_id)
- `idx_crown_accounts_status` ON (status)
- `idx_crown_accounts_agent_id` ON (agent_id)
- `idx_crown_accounts_use_for_fetch` ON (use_for_fetch)

#### 4. matches - èµ›äº‹è¡¨
å­˜å‚¨ä»çš‡å† å¹³å°æŠ“å–çš„èµ›äº‹ä¿¡æ¯å’Œå®æ—¶èµ”ç‡ã€‚

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| **åŸºæœ¬ä¿¡æ¯** |
| id | SERIAL | PRIMARY KEY | èµ›äº‹IDï¼Œè‡ªå¢ä¸»é”® |
| match_id | VARCHAR(100) | UNIQUE NOT NULL | å®˜ç½‘æ¯”èµ›IDï¼Œå”¯ä¸€æ ‡è¯† |
| league_name | VARCHAR(200) | NOT NULL | è”èµ›åç§°ï¼Œå¦‚ï¼šè¥¿ç­ç‰™ç”²ç»„è”èµ› |
| home_team | VARCHAR(100) | NOT NULL | ä¸»é˜Ÿåç§° |
| away_team | VARCHAR(100) | NOT NULL | å®¢é˜Ÿåç§° |
| match_time | TIMESTAMP | NOT NULL | æ¯”èµ›å¼€å§‹æ—¶é—´ |
| **æ¯”èµ›çŠ¶æ€** |
| status | VARCHAR(20) | DEFAULT 'scheduled' | çŠ¶æ€ï¼šscheduledï¼ˆæœªå¼€å§‹ï¼‰ã€liveï¼ˆè¿›è¡Œä¸­ï¼‰ã€finishedï¼ˆå·²ç»“æŸï¼‰ã€cancelledï¼ˆå·²å–æ¶ˆï¼‰ |
| current_score | VARCHAR(20) | | å½“å‰æ¯”åˆ†ï¼Œå¦‚ï¼š3-0 |
| match_period | VARCHAR(20) | | æ¯”èµ›é˜¶æ®µï¼Œå¦‚ï¼š2H*89:41ï¼ˆä¸‹åŠåœº89åˆ†41ç§’ï¼‰ |
| markets | JSONB | | ç›˜å£/èµ”ç‡åŸå§‹JSONç»“æ„ |
| last_synced_at | TIMESTAMP | | æœ€è¿‘ä¸€æ¬¡ä»å®˜ç½‘åŒæ­¥æ—¶é—´ |
| **å…¨åœºèµ”ç‡** |
| odds_home_win | DECIMAL(5,2) | | ä¸»èƒœèµ”ç‡ï¼ˆç‹¬èµ¢ï¼‰ |
| odds_draw | DECIMAL(5,2) | | å¹³å±€èµ”ç‡ï¼ˆç‹¬èµ¢ï¼‰ |
| odds_away_win | DECIMAL(5,2) | | å®¢èƒœèµ”ç‡ï¼ˆç‹¬èµ¢ï¼‰ |
| odds_handicap | DECIMAL(5,2) | | è®©çƒèµ”ç‡ |
| odds_over | DECIMAL(5,2) | | å¤§çƒèµ”ç‡ |
| odds_under | DECIMAL(5,2) | | å°çƒèµ”ç‡ |
| **åŠåœºèµ”ç‡** |
| odds_home_win_half | DECIMAL(5,2) | | åŠåœºä¸»èƒœèµ”ç‡ |
| odds_draw_half | DECIMAL(5,2) | | åŠåœºå¹³å±€èµ”ç‡ |
| odds_away_win_half | DECIMAL(5,2) | | åŠåœºå®¢èƒœèµ”ç‡ |
| odds_handicap_half | DECIMAL(5,2) | | åŠåœºè®©çƒèµ”ç‡ |
| odds_over_half | DECIMAL(5,2) | | åŠåœºå¤§çƒèµ”ç‡ |
| odds_under_half | DECIMAL(5,2) | | åŠåœºå°çƒèµ”ç‡ |
| **æ—¶é—´æˆ³** |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- `idx_matches_status` ON (status)
- `idx_matches_match_time` ON (match_time)

#### 5. bets - ä¸‹æ³¨è®°å½•è¡¨
å­˜å‚¨æ‰€æœ‰ä¸‹æ³¨è®°å½•ï¼ŒåŒ…æ‹¬ä¸‹æ³¨å‚æ•°ã€çŠ¶æ€ã€ç»“ç®—ç»“æœç­‰å®Œæ•´ä¿¡æ¯ã€‚

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| **åŸºæœ¬ä¿¡æ¯** |
| id | SERIAL | PRIMARY KEY | ä¸‹æ³¨è®°å½•IDï¼Œè‡ªå¢ä¸»é”® |
| user_id | INTEGER | NOT NULL REFERENCES users(id) | ä¸‹æ³¨ç”¨æˆ·ID |
| account_id | INTEGER | NOT NULL REFERENCES crown_accounts(id) | ä½¿ç”¨çš„çš‡å† è´¦å·ID |
| match_id | INTEGER | NOT NULL REFERENCES matches(id) | å…³è”çš„èµ›äº‹ID |
| **ä¸‹æ³¨ä¿¡æ¯** |
| bet_type | VARCHAR(50) | NOT NULL | æŠ•æ³¨ç±»å‹ï¼šç‹¬èµ¢ã€è®©çƒã€å¤§å°çƒã€åŠåœºç‹¬èµ¢ã€åŠåœºè®©çƒã€åŠåœºå¤§å°çƒ |
| bet_option | VARCHAR(100) | NOT NULL | å…·ä½“é€‰é¡¹ï¼Œå¦‚ï¼š[ç›˜å‰]å…¨åœºä¸»é˜Ÿ-0.5@0.88 |
| bet_amount | DECIMAL(15,2) | NOT NULL | æŠ•æ³¨é‡‘é¢ï¼ˆå®é™…é‡‘é¢ï¼‰ |
| odds | DECIMAL(5,2) | NOT NULL | æŠ•æ³¨æ—¶çš„èµ”ç‡ |
| min_odds | DECIMAL(6,3) | | ä¸‹æ³¨æ—¶ç”¨æˆ·è®¾ç½®çš„æœ€ä½èµ”ç‡ |
| official_odds | DECIMAL(6,3) | | çš‡å† è¿”å›çš„çœŸå®èµ”ç‡ |
| **ä¸‹æ³¨è®¾ç½®** |
| single_limit | DECIMAL(15,2) | | å•ç¬”é™é¢ |
| interval_seconds | INTEGER | DEFAULT 3 | é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œç”¨äºæ‰¹é‡ä¸‹æ³¨ |
| quantity | INTEGER | DEFAULT 1 | ä¸‹æ³¨æ•°é‡ |
| **çŠ¶æ€å’Œç»“æœ** |
| status | VARCHAR(20) | DEFAULT 'pending' | çŠ¶æ€ï¼špendingï¼ˆå¾…å¤„ç†ï¼‰ã€confirmedï¼ˆå·²ä¸‹å•ï¼‰ã€cancelledï¼ˆå·²å–æ¶ˆï¼‰ã€settledï¼ˆå·²ç»“ç®—ï¼‰ |
| result | VARCHAR(20) | | ç»“æœï¼šwinï¼ˆèµ¢ï¼‰ã€loseï¼ˆè¾“ï¼‰ã€drawï¼ˆå¹³ï¼‰ã€cancelledï¼ˆå–æ¶ˆï¼‰ |
| payout | DECIMAL(15,2) | DEFAULT 0 | æ´¾å½©é‡‘é¢ |
| profit_loss | DECIMAL(15,2) | DEFAULT 0 | ç›ˆäºé‡‘é¢ï¼ˆæ­£æ•°ä¸ºç›ˆåˆ©ï¼Œè´Ÿæ•°ä¸ºäºæŸï¼‰ |
| score | VARCHAR(50) | | æ¯”èµ›æ¯”åˆ†ï¼Œå¦‚ï¼š1-1ã€2-0 |
| **è™šæ‹Ÿé‡‘é¢** |
| virtual_bet_amount | DECIMAL(15,2) | | è™šæ‹Ÿä¸‹æ³¨é‡‘é¢ï¼ˆç”¨äºæŠ˜æ‰£è®¡ç®—ï¼‰ |
| virtual_profit_loss | DECIMAL(15,2) | | è™šæ‹Ÿç›ˆäºé‡‘é¢ |
| result_score | VARCHAR(50) | | ç»“ç®—æ¯”åˆ† |
| result_text | VARCHAR(255) | | ç»“ç®—æ–‡æœ¬ |
| **å®˜ç½‘ä¿¡æ¯** |
| official_bet_id | VARCHAR(100) | | å®˜ç½‘ä¸‹æ³¨å•å·ï¼Œå¦‚ï¼š22870402347 |
| confirmed_at | TIMESTAMP | | ç¡®è®¤æ—¶é—´ï¼ˆä¸‹æ³¨æˆåŠŸæ—¶é—´ï¼‰ |
| settled_at | TIMESTAMP | | ç»“ç®—æ—¶é—´ |
| **æ—¶é—´æˆ³** |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**å­—æ®µè¯´æ˜**ï¼š
- **bet_amount vs virtual_bet_amount**ï¼šå®é™…é‡‘é¢æ˜¯çš‡å† è´¦å·å®é™…ä¸‹æ³¨çš„é‡‘é¢ï¼Œè™šæ‹Ÿé‡‘é¢æ˜¯æ ¹æ®æŠ˜æ‰£è®¡ç®—çš„å¹³å°é‡‘é¢
- **profit_loss vs virtual_profit_loss**ï¼šå®é™…ç›ˆäºæ˜¯çš‡å† è´¦å·çš„ç›ˆäºï¼Œè™šæ‹Ÿç›ˆäºæ˜¯å¹³å°çš„ç›ˆäº
- **status çŠ¶æ€æµè½¬**ï¼špending â†’ confirmed â†’ settled/cancelled
- **score**ï¼šæ¯”èµ›æ¯”åˆ†ï¼Œä»çš‡å† APIçš„ `ballActRet` å­—æ®µè·å–

**ç´¢å¼•**ï¼š
- `idx_bets_user_id` ON (user_id)
- `idx_bets_account_id` ON (account_id)
- `idx_bets_status` ON (status)
- `idx_bets_created_at` ON (created_at)

#### 6. coin_transactions - é‡‘å¸æµæ°´è¡¨
è®°å½•æ‰€æœ‰é‡‘å¸å˜åŠ¨ï¼ŒåŒ…æ‹¬æ¶ˆè€—ã€è¿”è¿˜ã€è½¬è´¦ç­‰æ“ä½œã€‚

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| **åŸºæœ¬ä¿¡æ¯** |
| id | SERIAL | PRIMARY KEY | æµæ°´IDï¼Œè‡ªå¢ä¸»é”® |
| user_id | INTEGER | NOT NULL REFERENCES users(id) | ç”¨æˆ·ID |
| account_id | INTEGER | REFERENCES crown_accounts(id) | å…³è”çš„çš‡å† è´¦å·IDï¼ˆå¯ä¸ºç©ºï¼‰ |
| bet_id | INTEGER | REFERENCES bets(id) | å…³è”çš„ä¸‹æ³¨è®°å½•IDï¼ˆå¯ä¸ºç©ºï¼‰ |
| **æµæ°´ä¿¡æ¯** |
| transaction_id | VARCHAR(100) | UNIQUE NOT NULL | æµæ°´å·ï¼Œå”¯ä¸€æ ‡è¯†ï¼Œå¦‚ï¼šZMZOrXUdaDksA88pzCnFN |
| transaction_type | VARCHAR(50) | NOT NULL | ç±»å‹ï¼šæ¶ˆè€—ã€è¿”è¿˜ã€è½¬è´¦ã€æ”¶æ¬¾ã€å……å€¼ã€æç° |
| description | TEXT | | æè¿°ï¼Œå¦‚ï¼šcb1995959ç¥¨å•[GsC_wTyX2LmiZYm_Eo3]æ¶ˆè€— |
| **é‡‘é¢å˜åŒ–** |
| amount | DECIMAL(15,2) | NOT NULL | å˜åŠ¨é‡‘é¢ï¼ˆæ­£æ•°ä¸ºæ”¶å…¥ï¼Œè´Ÿæ•°ä¸ºæ”¯å‡ºï¼‰ |
| balance_before | DECIMAL(15,2) | NOT NULL | å˜åŠ¨å‰ä½™é¢ |
| balance_after | DECIMAL(15,2) | NOT NULL | å˜åŠ¨åä½™é¢ |
| **æ—¶é—´æˆ³** |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |

**ä¸šåŠ¡é€»è¾‘**ï¼š
- **æ¶ˆè€—**ï¼šä¸‹æ³¨æ—¶æ‰£é™¤é‡‘å¸ï¼Œamountä¸ºè´Ÿæ•°
- **è¿”è¿˜**ï¼šä¸‹æ³¨è¢«å–æ¶ˆæ—¶è¿”è¿˜é‡‘å¸ï¼Œamountä¸ºæ­£æ•°
- **è½¬è´¦**ï¼šä»£ç†ç»™å‘˜å·¥è½¬è´¦ï¼Œè½¬å‡ºæ–¹amountä¸ºè´Ÿæ•°ï¼Œè½¬å…¥æ–¹amountä¸ºæ­£æ•°
- **å……å€¼**ï¼šç®¡ç†å‘˜ç»™ä»£ç†å……å€¼ï¼Œamountä¸ºæ­£æ•°

**ç´¢å¼•**ï¼š
- `idx_coin_transactions_user_id` ON (user_id)
- `idx_coin_transactions_created_at` ON (created_at)

#### 7. settings - ç³»ç»Ÿè®¾ç½®è¡¨
å­˜å‚¨ç”¨æˆ·çš„ä¸ªæ€§åŒ–è®¾ç½®ã€‚

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | SERIAL | PRIMARY KEY | è®¾ç½®IDï¼Œè‡ªå¢ä¸»é”® |
| user_id | INTEGER | NOT NULL REFERENCES users(id) | ç”¨æˆ·ID |
| setting_key | VARCHAR(100) | NOT NULL | è®¾ç½®é”®å |
| setting_value | TEXT | | è®¾ç½®å€¼ï¼ˆJSONæ ¼å¼ï¼‰ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |

**å”¯ä¸€çº¦æŸ**ï¼š(user_id, setting_key)

#### 8. account_shares - è´¦å·å…±äº«è¡¨
ç®¡ç†è´¦å·å…±äº«å…³ç³»ã€‚

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | SERIAL | PRIMARY KEY | å…±äº«è®°å½•ID |
| account_id | INTEGER | NOT NULL REFERENCES crown_accounts(id) | è¢«å…±äº«çš„è´¦å·ID |
| shared_to_user_id | INTEGER | NOT NULL REFERENCES users(id) | å…±äº«ç»™çš„ç”¨æˆ·ID |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |

#### 9. account_history - è´¦å·å†å²è®°å½•è¡¨
è®°å½•è´¦å·çš„æ“ä½œå†å²ã€‚

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | SERIAL | PRIMARY KEY | å†å²è®°å½•ID |
| account_id | INTEGER | NOT NULL REFERENCES crown_accounts(id) | è´¦å·ID |
| action | VARCHAR(50) | NOT NULL | æ“ä½œç±»å‹ï¼šloginã€logoutã€betã€errorç­‰ |
| details | JSONB | | æ“ä½œè¯¦æƒ…ï¼ˆJSONæ ¼å¼ï¼‰ |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |

---

## APIæ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯
- **Base URL**ï¼š`https://aibcbot.top/api`
- **è®¤è¯æ–¹å¼**ï¼šJWT Tokenï¼ˆBearer Tokenï¼‰
- **è¯·æ±‚å¤´**ï¼š
  ```
  Authorization: Bearer <token>
  Content-Type: application/json
  ```

### é€šç”¨å“åº”æ ¼å¼
```typescript
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
}
```

### 1. è®¤è¯æ¥å£ (/api/auth)

#### 1.1 ç”¨æˆ·ç™»å½•
```
POST /api/auth/login
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "username": "zhuren",
  "password": "123456"
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "username": "zhuren",
      "email": "zhuren@example.com",
      "role": "admin"
    }
  }
}
```

#### 1.2 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```
GET /api/auth/me
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "id": 1,
    "username": "zhuren",
    "email": "zhuren@example.com",
    "role": "admin",
    "balance": 99500.00
  }
}
```

### 2. è´¦å·ç®¡ç†æ¥å£ (/api/accounts)

#### 2.1 è·å–è´¦å·åˆ—è¡¨
```
GET /api/accounts?page=1&pageSize=20
```

#### 2.2 åˆ›å»ºè´¦å·
```
POST /api/accounts
```

#### 2.3 æ›´æ–°è´¦å·
```
PUT /api/accounts/:id
```

#### 2.4 åˆ é™¤è´¦å·
```
DELETE /api/accounts/:id
```

#### 2.5 æµ‹è¯•è´¦å·ç™»å½•
```
POST /api/accounts/:id/test-login
```

### 3. èµ›äº‹ç®¡ç†æ¥å£ (/api/matches)

#### 3.1 è·å–èµ›äº‹åˆ—è¡¨
```
GET /api/matches?date=2025-10-27&status=scheduled
```

#### 3.2 åŒæ­¥èµ›äº‹æ•°æ®
```
POST /api/matches/sync
```

#### 3.3 è·å–èµ›äº‹è¯¦æƒ…
```
GET /api/matches/:id
```

### 4. ä¸‹æ³¨è®°å½•æ¥å£ (/api/bets)

#### 4.1 è·å–ä¸‹æ³¨åˆ—è¡¨
```
GET /api/bets?date=2025-10-27&status=settled
```

#### 4.2 è·å–ä¸‹æ³¨ç»Ÿè®¡
```
GET /api/bets/stats?date=2025-10-27
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "data": {
    "totalTickets": 17,
    "totalBets": 25,
    "totalAmount": 2500,
    "profitLoss": -43,
    "returnRate": -1.7,
    "unsettled": 0,
    "cancelled": 2
  }
}
```

#### 4.3 åˆ›å»ºä¸‹æ³¨
```
POST /api/bets
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "accountId": 1,
  "matchId": 123,
  "betType": "å¤§å°çƒ",
  "betOption": "[ç›˜å‰]å…¨åœºå°çƒ(1)@1.13",
  "betAmount": 300,
  "odds": 1.13,
  "minOdds": 1.10,
  "quantity": 1,
  "intervalSeconds": 3
}
```

#### 4.4 åŒæ­¥ç»“ç®—ç»“æœ
```
POST /api/bets/sync-settlements
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "account_ids": [1, 2, 3]  // å¯é€‰ï¼Œä¸ä¼ åˆ™åŒæ­¥æ‰€æœ‰è´¦å·
}
```

**å“åº”**ï¼š
```json
{
  "success": true,
  "message": "åŒæ­¥å®Œæˆï¼Œæ›´æ–° 5 æ¡æ³¨å•",
  "data": {
    "updated_bets": [
      {
        "id": 123,
        "ticketId": "22870402347",
        "status": "settled",
        "result": "win",
        "payout": 469.5,
        "profit_loss": 169.5,
        "score": "1-1"
      }
    ],
    "errors": [],
    "skipped": []
  }
}
```

### 5. é‡‘å¸æµæ°´æ¥å£ (/api/coins)

#### 5.1 è·å–æµæ°´åˆ—è¡¨
```
GET /api/coins?page=1&pageSize=20&type=æ¶ˆè€—
```

#### 5.2 è·å–æµæ°´ç»Ÿè®¡
```
GET /api/coins/stats?startDate=2025-10-01&endDate=2025-10-27
```

### 6. ä»£ç†ç®¡ç†æ¥å£ (/api/agents)

#### 6.1 è·å–ä»£ç†åˆ—è¡¨
```
GET /api/agents
```

#### 6.2 åˆ›å»ºä»£ç†
```
POST /api/agents
```

#### 6.3 ç»™ä»£ç†å……å€¼
```
POST /api/agents/:id/recharge
```

### 7. å‘˜å·¥ç®¡ç†æ¥å£ (/api/staff)

#### 7.1 è·å–å‘˜å·¥åˆ—è¡¨
```
GET /api/staff
```

#### 7.2 åˆ›å»ºå‘˜å·¥
```
POST /api/staff
```

---

## éƒ¨ç½²æŒ‡å—

### æœåŠ¡å™¨ç¯å¢ƒè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 22.04 LTS æˆ–æ›´é«˜ç‰ˆæœ¬
- **Node.js**ï¼šv22.18.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **PostgreSQL**ï¼š14 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Nginx**ï¼šæœ€æ–°ç¨³å®šç‰ˆ
- **PM2**ï¼šæœ€æ–°ç‰ˆæœ¬

### 1. æœåŠ¡å™¨åˆå§‹åŒ–

#### 1.1 æ›´æ–°ç³»ç»Ÿ
```bash
sudo apt update && sudo apt upgrade -y
```

#### 1.2 å®‰è£… Node.js
```bash
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt install -y nodejs
node --version  # éªŒè¯å®‰è£…
```

#### 1.3 å®‰è£… PostgreSQL
```bash
sudo apt install -y postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

#### 1.4 å®‰è£… Nginx
```bash
sudo apt install -y nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### 1.5 å®‰è£… PM2
```bash
sudo npm install -g pm2
```

### 2. æ•°æ®åº“é…ç½®

#### 2.1 åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
```bash
sudo -u postgres psql

# åœ¨ PostgreSQL å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š
CREATE DATABASE hgzuqiu;
CREATE USER hgzuqiu WITH PASSWORD 'AbDN22pKhcsNnJSk';
GRANT ALL PRIVILEGES ON DATABASE hgzuqiu TO hgzuqiu;
\q
```

#### 2.2 å¯¼å…¥æ•°æ®åº“ç»“æ„
```bash
cd /www/wwwroot/aibcbot.top
psql -h 127.0.0.1 -U hgzuqiu -d hgzuqiu -f database/schema.sql
```

#### 2.3 è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
cd backend
npm run migrate
```

### 3. åç«¯éƒ¨ç½²

#### 3.1 å…‹éš†ä»£ç 
```bash
cd /www/wwwroot
git clone <repository-url> aibcbot.top
cd aibcbot.top
```

#### 3.2 é…ç½®ç¯å¢ƒå˜é‡
```bash
cd backend
cp .env.example .env
nano .env
```

**ç¯å¢ƒå˜é‡é…ç½®**ï¼š
```env
# æ•°æ®åº“é…ç½®
DB_HOST=127.0.0.1
DB_PORT=5432
DB_NAME=hgzuqiu
DB_USER=hgzuqiu
DB_PASSWORD=AbDN22pKhcsNnJSk

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# æœåŠ¡å™¨é…ç½®
PORT=3000
NODE_ENV=production

# çš‡å† å¹³å°é…ç½®
CROWN_API_BASE_URL=https://hga050.com
CROWN_BACKUP_URLS=hga026.com,hga027.com,hga030.com,hga035.com,hga038.com,hga039.com,hga050.com
```

#### 3.3 å®‰è£…ä¾èµ–
```bash
npm install
```

#### 3.4 æ„å»ºé¡¹ç›®
```bash
npm run build
```

#### 3.5 å¯åŠ¨åç«¯æœåŠ¡
```bash
pm2 start dist/app.js --name bclogin-backend
pm2 save
pm2 startup
```

### 4. å‰ç«¯éƒ¨ç½²

#### 4.1 å®‰è£…ä¾èµ–
```bash
cd ../frontend
npm install
```

#### 4.2 æ„å»ºå‰ç«¯
```bash
npm run build
```

### 5. Nginx é…ç½®

#### 5.1 åˆ›å»º Nginx é…ç½®æ–‡ä»¶
```bash
sudo nano /etc/nginx/sites-available/aibcbot.top
```

**é…ç½®å†…å®¹**ï¼š
```nginx
server {
    listen 80;
    server_name aibcbot.top www.aibcbot.top;

    # å‰ç«¯é™æ€æ–‡ä»¶
    root /www/wwwroot/aibcbot.top/frontend/dist;
    index index.html;

    # å‰ç«¯è·¯ç”±
    location / {
        try_files $uri $uri/ /index.html;
    }

    # åç«¯ API ä»£ç†
    location /api {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 5.2 å¯ç”¨é…ç½®
```bash
sudo ln -s /etc/nginx/sites-available/aibcbot.top /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 6. SSL è¯ä¹¦é…ç½®ï¼ˆå¯é€‰ï¼‰

#### 6.1 å®‰è£… Certbot
```bash
sudo apt install -y certbot python3-certbot-nginx
```

#### 6.2 è·å–è¯ä¹¦
```bash
sudo certbot --nginx -d aibcbot.top -d www.aibcbot.top
```

### 7. åˆ›å»ºç®¡ç†å‘˜è´¦å·
```bash
cd /www/wwwroot/aibcbot.top/backend
node ensure-admin.js
```

---

## å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»º

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd bclogin-system
```

#### 2. å®‰è£…ä¾èµ–

**åç«¯**ï¼š
```bash
cd backend
npm install
```

**å‰ç«¯**ï¼š
```bash
cd frontend
npm install
```

#### 3. é…ç½®æ•°æ®åº“
```bash
# åˆ›å»ºæœ¬åœ°æ•°æ®åº“
createdb bclogin_system

# å¯¼å…¥æ•°æ®åº“ç»“æ„
psql -d bclogin_system -f database/schema.sql

# è¿è¡Œè¿ç§»
cd backend
npm run migrate
```

#### 4. é…ç½®ç¯å¢ƒå˜é‡
```bash
cd backend
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®æœ¬åœ°æ•°æ®åº“è¿æ¥
```

#### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

**åç«¯**ï¼š
```bash
cd backend
npm run dev  # å¯åŠ¨åœ¨ http://localhost:3000
```

**å‰ç«¯**ï¼š
```bash
cd frontend
npm run dev  # å¯åŠ¨åœ¨ http://localhost:5173
```

### ä»£ç è§„èŒƒ

#### TypeScript è§„èŒƒ
- ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼ˆstrict modeï¼‰
- æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰æ˜ç¡®çš„è¿”å›ç±»å‹
- é¿å…ä½¿ç”¨ `any` ç±»å‹ï¼Œä½¿ç”¨ `unknown` æˆ–å…·ä½“ç±»å‹
- ä½¿ç”¨æ¥å£ï¼ˆinterfaceï¼‰å®šä¹‰æ•°æ®ç»“æ„

#### å‘½åè§„èŒƒ
- **æ–‡ä»¶å**ï¼šä½¿ç”¨ kebab-caseï¼ˆå¦‚ï¼š`user-service.ts`ï¼‰
- **ç»„ä»¶å**ï¼šä½¿ç”¨ PascalCaseï¼ˆå¦‚ï¼š`AccountCard.tsx`ï¼‰
- **å˜é‡å**ï¼šä½¿ç”¨ camelCaseï¼ˆå¦‚ï¼š`userName`ï¼‰
- **å¸¸é‡å**ï¼šä½¿ç”¨ UPPER_SNAKE_CASEï¼ˆå¦‚ï¼š`MAX_RETRY_COUNT`ï¼‰
- **æ¥å£å**ï¼šä½¿ç”¨ PascalCaseï¼Œä»¥ `I` å¼€å¤´ï¼ˆå¦‚ï¼š`IUser`ï¼‰
- **ç±»å‹å**ï¼šä½¿ç”¨ PascalCaseï¼ˆå¦‚ï¼š`UserRole`ï¼‰

#### Git æäº¤è§„èŒƒ
ä½¿ç”¨ Conventional Commits è§„èŒƒï¼š
- `feat:` æ–°åŠŸèƒ½
- `fix:` ä¿®å¤bug
- `docs:` æ–‡æ¡£æ›´æ–°
- `style:` ä»£ç æ ¼å¼è°ƒæ•´
- `refactor:` é‡æ„
- `test:` æµ‹è¯•ç›¸å…³
- `chore:` æ„å»º/å·¥å…·ç›¸å…³

ç¤ºä¾‹ï¼š
```bash
git commit -m "feat: æ·»åŠ è´¦å·æ‰¹é‡å¯¼å…¥åŠŸèƒ½"
git commit -m "fix: ä¿®å¤ä¸‹æ³¨ç»“ç®—åŒæ­¥å¤±è´¥é—®é¢˜"
```

### æ•°æ®åº“è¿ç§»

#### åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
```bash
cd backend/migrations
touch YYYYMMDD_description.sql
```

#### è¿ç§»æ–‡ä»¶æ ¼å¼
```sql
-- æè¿°è¿ç§»çš„ç›®çš„
-- æ—¥æœŸï¼šYYYY-MM-DD

-- æ·»åŠ æ–°åˆ—
ALTER TABLE table_name ADD COLUMN column_name TYPE;

-- æ·»åŠ æ³¨é‡Š
COMMENT ON COLUMN table_name.column_name IS 'å­—æ®µè¯´æ˜';
```

#### è¿è¡Œè¿ç§»
```bash
cd backend
npm run migrate
```

### è°ƒè¯•æŠ€å·§

#### åç«¯è°ƒè¯•
1. æŸ¥çœ‹ PM2 æ—¥å¿—ï¼š
```bash
pm2 logs bclogin-backend
pm2 logs bclogin-backend --lines 100
```

2. æŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼š
```bash
pm2 logs bclogin-backend --lines 0
```

3. é‡å¯æœåŠ¡ï¼š
```bash
pm2 restart bclogin-backend
```

#### å‰ç«¯è°ƒè¯•
1. ä½¿ç”¨ Chrome DevTools
2. æŸ¥çœ‹ Network é¢æ¿æ£€æŸ¥ API è¯·æ±‚
3. ä½¿ç”¨ React DevTools æŸ¥çœ‹ç»„ä»¶çŠ¶æ€

#### æ•°æ®åº“è°ƒè¯•
1. è¿æ¥æ•°æ®åº“ï¼š
```bash
psql -h 127.0.0.1 -U hgzuqiu -d hgzuqiu
```

2. æŸ¥çœ‹è¡¨ç»“æ„ï¼š
```sql
\d table_name
```

3. æŸ¥çœ‹æ‰€æœ‰è¡¨ï¼š
```sql
\dt
```

4. æŸ¥è¯¢æ•°æ®ï¼š
```sql
SELECT * FROM bets WHERE status = 'pending' LIMIT 10;
```

---

## å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“ç›¸å…³

#### Q: æ•°æ®åº“è¿æ¥å¤±è´¥
**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. PostgreSQL æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`sudo systemctl status postgresql`
2. æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®ï¼šæ£€æŸ¥ `backend/.env` æ–‡ä»¶
3. æ•°æ®åº“ç”¨æˆ·æƒé™æ˜¯å¦æ­£ç¡®ï¼š
```sql
GRANT ALL PRIVILEGES ON DATABASE hgzuqiu TO hgzuqiu;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO hgzuqiu;
```

#### Q: ç¼ºå°‘æ•°æ®åº“åˆ—
**A**: è¿è¡Œæ•°æ®åº“è¿ç§»ï¼š
```bash
cd backend
npm run migrate
```

å¦‚æœè¿ç§»å¤±è´¥ï¼Œæ‰‹åŠ¨æ‰§è¡Œ SQLï¼š
```bash
psql -h 127.0.0.1 -U hgzuqiu -d hgzuqiu -f migrations/xxx.sql
```

### 2. åç«¯ç›¸å…³

#### Q: åç«¯å¯åŠ¨å¤±è´¥
**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. Node.js ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ï¼š`node --version`ï¼ˆéœ€è¦ v22+ï¼‰
2. ä¾èµ–æ˜¯å¦å®‰è£…å®Œæ•´ï¼š`npm install`
3. ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®ï¼šæ£€æŸ¥ `.env` æ–‡ä»¶
4. ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`lsof -i :3000`

#### Q: JWT Token éªŒè¯å¤±è´¥
**A**:
1. æ£€æŸ¥ `JWT_SECRET` æ˜¯å¦é…ç½®
2. Token æ˜¯å¦è¿‡æœŸï¼ˆé»˜è®¤24å°æ—¶ï¼‰
3. å‰ç«¯æ˜¯å¦æ­£ç¡®å‘é€ Authorization å¤´

#### Q: åŒæ­¥ç»“ç®—å¤±è´¥
**A**:
1. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æœ‰ `score` åˆ—ï¼š
```sql
SELECT column_name FROM information_schema.columns
WHERE table_name = 'bets' AND column_name = 'score';
```

2. å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ åˆ—ï¼š
```sql
ALTER TABLE bets ADD COLUMN score VARCHAR(50);
```

3. æ£€æŸ¥çš‡å† è´¦å·æ˜¯å¦èƒ½æ­£å¸¸ç™»å½•
4. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`pm2 logs bclogin-backend`

### 3. å‰ç«¯ç›¸å…³

#### Q: å‰ç«¯æ„å»ºå¤±è´¥
**A**:
1. æ¸…é™¤ç¼“å­˜ï¼š`rm -rf node_modules package-lock.json && npm install`
2. æ£€æŸ¥ Node.js ç‰ˆæœ¬
3. æ£€æŸ¥ TypeScript ç‰ˆæœ¬å…¼å®¹æ€§

#### Q: API è¯·æ±‚å¤±è´¥ï¼ˆCORS é”™è¯¯ï¼‰
**A**:
1. æ£€æŸ¥åç«¯ CORS é…ç½®
2. æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ proxy_pass
3. ç¡®ä¿å‰ç«¯è¯·æ±‚çš„ URL æ­£ç¡®

#### Q: ç§»åŠ¨ç«¯æ˜¾ç¤ºå¼‚å¸¸
**A**:
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
2. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æœ€æ–°çš„ CSS
3. ä½¿ç”¨ Chrome DevTools çš„ç§»åŠ¨è®¾å¤‡æ¨¡æ‹Ÿå™¨æµ‹è¯•

### 4. éƒ¨ç½²ç›¸å…³

#### Q: Nginx é…ç½®ä¸ç”Ÿæ•ˆ
**A**:
1. æµ‹è¯•é…ç½®ï¼š`sudo nginx -t`
2. é‡æ–°åŠ è½½ï¼š`sudo systemctl reload nginx`
3. æ£€æŸ¥æ—¥å¿—ï¼š`sudo tail -f /var/log/nginx/error.log`

#### Q: PM2 è¿›ç¨‹å¼‚å¸¸é€€å‡º
**A**:
1. æŸ¥çœ‹æ—¥å¿—ï¼š`pm2 logs bclogin-backend --err`
2. æ£€æŸ¥å†…å­˜ä½¿ç”¨ï¼š`pm2 monit`
3. é‡å¯è¿›ç¨‹ï¼š`pm2 restart bclogin-backend`

#### Q: ä»£ç æ›´æ–°åä¸ç”Ÿæ•ˆ
**A**:
```bash
# åç«¯æ›´æ–°
cd /www/wwwroot/aibcbot.top
git pull origin main
cd backend
npm install
npm run build
pm2 restart bclogin-backend

# å‰ç«¯æ›´æ–°
cd ../frontend
npm install
npm run build
sudo systemctl reload nginx
```

### 5. çš‡å† å¹³å°ç›¸å…³

#### Q: è´¦å·ç™»å½•å¤±è´¥
**A**:
1. æ£€æŸ¥è´¦å·å¯†ç æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥ä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥çš‡å† ç«™ç‚¹æ˜¯å¦å¯è®¿é—®
4. å°è¯•ä½¿ç”¨å¤‡ç”¨ç«™ç‚¹

#### Q: èµ›äº‹æ•°æ®æŠ“å–å¤±è´¥
**A**:
1. æ£€æŸ¥æŠ“å–è´¦å·æ˜¯å¦åœ¨çº¿
2. æ£€æŸ¥è´¦å·çš„ `use_for_fetch` å­—æ®µæ˜¯å¦ä¸º true
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æŸ¥çœ‹åç«¯æ—¥å¿—

#### Q: ä¸‹æ³¨å¤±è´¥
**A**:
1. æ£€æŸ¥è´¦å·ä½™é¢æ˜¯å¦å……è¶³
2. æ£€æŸ¥èµ”ç‡æ˜¯å¦å˜åŒ–
3. æ£€æŸ¥è´¦å·é™é¢è®¾ç½®
4. æ£€æŸ¥è´¦å·çŠ¶æ€æ˜¯å¦æ­£å¸¸

### 6. é‡‘å¸ç³»ç»Ÿç›¸å…³

#### Q: é‡‘å¸æ‰£é™¤å¼‚å¸¸
**A**:
1. æ£€æŸ¥ `coin_transactions` è¡¨çš„æµæ°´è®°å½•
2. æ£€æŸ¥ç”¨æˆ·ä½™é¢æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„é‡‘å¸æ“ä½œè®°å½•

#### Q: ä¸‹æ³¨å–æ¶ˆåé‡‘å¸æœªè¿”è¿˜
**A**:
1. æ£€æŸ¥ä¸‹æ³¨çŠ¶æ€æ˜¯å¦ä¸º `cancelled`
2. æ£€æŸ¥ `coin_transactions` è¡¨æ˜¯å¦æœ‰è¿”è¿˜è®°å½•
3. æ‰‹åŠ¨æ‰§è¡Œç»“ç®—åŒæ­¥ï¼šç‚¹å‡»"ç»“ç®—"æŒ‰é’®

---

## ç³»ç»Ÿç»´æŠ¤

### æ—¥å¸¸ç»´æŠ¤ä»»åŠ¡

#### 1. æ•°æ®åº“å¤‡ä»½
```bash
# æ¯å¤©å¤‡ä»½æ•°æ®åº“
pg_dump -h 127.0.0.1 -U hgzuqiu hgzuqiu > backup_$(date +%Y%m%d).sql

# å‹ç¼©å¤‡ä»½
gzip backup_$(date +%Y%m%d).sql
```

#### 2. æ—¥å¿—æ¸…ç†
```bash
# æ¸…ç† PM2 æ—¥å¿—
pm2 flush

# æ¸…ç† Nginx æ—¥å¿—
sudo truncate -s 0 /var/log/nginx/access.log
sudo truncate -s 0 /var/log/nginx/error.log
```

#### 3. ç›‘æ§æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥åç«¯æœåŠ¡
pm2 status

# æ£€æŸ¥ Nginx æœåŠ¡
sudo systemctl status nginx

# æ£€æŸ¥æ•°æ®åº“æœåŠ¡
sudo systemctl status postgresql

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
free -h
```

#### 4. æ€§èƒ½ä¼˜åŒ–
```bash
# æ•°æ®åº“æ€§èƒ½åˆ†æ
psql -h 127.0.0.1 -U hgzuqiu -d hgzuqiu -c "
SELECT schemaname, tablename,
       pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
"

# æ¸…ç†æ•°æ®åº“
psql -h 127.0.0.1 -U hgzuqiu -d hgzuqiu -c "VACUUM ANALYZE;"
```

### å®šæœŸç»´æŠ¤ä»»åŠ¡

#### æ¯å‘¨ä»»åŠ¡
1. æ£€æŸ¥ç³»ç»Ÿæ›´æ–°ï¼š`sudo apt update && sudo apt upgrade`
2. æ£€æŸ¥ç£ç›˜ç©ºé—´
3. æ£€æŸ¥æ•°æ®åº“æ€§èƒ½
4. å®¡æŸ¥é”™è¯¯æ—¥å¿—

#### æ¯æœˆä»»åŠ¡
1. æ•°æ®åº“å®Œæ•´å¤‡ä»½
2. æ¸…ç†æ—§çš„å¤‡ä»½æ–‡ä»¶
3. å®¡æŸ¥ç”¨æˆ·æƒé™
4. æ›´æ–°ä¾èµ–åŒ…ï¼š`npm update`

---

## å®‰å…¨å»ºè®®

### 1. å¯†ç å®‰å…¨
- ä½¿ç”¨å¼ºå¯†ç ï¼ˆè‡³å°‘12ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
- å®šæœŸæ›´æ¢å¯†ç 
- ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†ç 
- ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯

### 2. æ•°æ®åº“å®‰å…¨
- é™åˆ¶æ•°æ®åº“è®¿é—®IP
- ä½¿ç”¨å¼ºå¯†ç 
- å®šæœŸå¤‡ä»½æ•°æ®
- å¯ç”¨ SSL è¿æ¥

### 3. API å®‰å…¨
- ä½¿ç”¨ HTTPS
- å®æ–½é€Ÿç‡é™åˆ¶
- éªŒè¯æ‰€æœ‰è¾“å…¥
- ä½¿ç”¨ JWT Token è®¤è¯
- è®¾ç½®åˆç†çš„ Token è¿‡æœŸæ—¶é—´

### 4. æœåŠ¡å™¨å®‰å…¨
- é…ç½®é˜²ç«å¢™
- ç¦ç”¨ root ç™»å½•
- ä½¿ç”¨ SSH å¯†é’¥è®¤è¯
- å®šæœŸæ›´æ–°ç³»ç»Ÿ
- ç›‘æ§å¼‚å¸¸è®¿é—®

---

## è”ç³»æ–¹å¼

### æŠ€æœ¯æ”¯æŒ
- **é¡¹ç›®åœ°å€**ï¼šhttps://github.com/latiaodream/hgzuqiu
- **çº¿ä¸Šåœ°å€**ï¼šhttps://aibcbot.top
- **æœåŠ¡å™¨IP**ï¼š47.238.112.207

### é»˜è®¤è´¦å·
- **ç®¡ç†å‘˜è´¦å·**ï¼šzhuren / 123456
- **æ•°æ®åº“**ï¼šhgzuqiu / AbDN22pKhcsNnJSk

---

## æ›´æ–°æ—¥å¿—

### 2025-10-27
- âœ… ä¿®å¤ï¼šæ·»åŠ  `score` åˆ—åˆ° `bets` è¡¨ï¼Œè§£å†³åŒæ­¥ç»“ç®—å¤±è´¥é—®é¢˜
- âœ… ä¼˜åŒ–ï¼šå®Œæˆæ‰€æœ‰é¡µé¢çš„ç§»åŠ¨ç«¯å“åº”å¼ä¼˜åŒ–
- âœ… ä¼˜åŒ–ï¼šèµ›äº‹ç®¡ç†é¡µé¢ç›˜å£æ˜¾ç¤ºä¼˜åŒ–ï¼ˆåˆ†ä¸¤æ’æ˜¾ç¤ºï¼‰
- âœ… ä¿®å¤ï¼šadmin ç”¨æˆ·æŸ¥çœ‹ä¸‹æ³¨è®°å½•æƒé™é—®é¢˜

### 2025-10-26
- âœ… æ–°å¢ï¼šä¸‹æ³¨è®°å½•é¡µé¢
- âœ… æ–°å¢ï¼šé‡‘å¸æµæ°´é¡µé¢
- âœ… æ–°å¢ï¼šç«™ç‚¹ç®¡ç†é¡µé¢
- âœ… ä¼˜åŒ–ï¼šè´¦å·ç®¡ç†é¡µé¢ç§»åŠ¨ç«¯æ˜¾ç¤º

### 2025-10-25
- âœ… æ–°å¢ï¼šèµ›äº‹ç®¡ç†é¡µé¢
- âœ… æ–°å¢ï¼šè‡ªåŠ¨ä¸‹æ³¨åŠŸèƒ½
- âœ… æ–°å¢ï¼šç»“ç®—åŒæ­¥åŠŸèƒ½

---

## é™„å½•

### A. çš‡å† å¤‡ç”¨ç«™ç‚¹åˆ—è¡¨
- hga026.com
- hga027.com
- hga030.com
- hga035.com
- hga038.com
- hga039.com
- hga050.com
- mos011.com
- mos022.com
- mos033.com
- mos055.com
- mos066.com
- mos100.com

### B. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

#### æœåŠ¡å™¨ç®¡ç†
```bash
# SSH ç™»å½•
ssh root@47.238.112.207

# æŸ¥çœ‹è¿›ç¨‹
pm2 list
pm2 monit

# é‡å¯æœåŠ¡
pm2 restart bclogin-backend
sudo systemctl reload nginx

# æŸ¥çœ‹æ—¥å¿—
pm2 logs bclogin-backend
sudo tail -f /var/log/nginx/error.log
```

#### æ•°æ®åº“ç®¡ç†
```bash
# è¿æ¥æ•°æ®åº“
psql -h 127.0.0.1 -U hgzuqiu -d hgzuqiu

# å¤‡ä»½æ•°æ®åº“
pg_dump -h 127.0.0.1 -U hgzuqiu hgzuqiu > backup.sql

# æ¢å¤æ•°æ®åº“
psql -h 127.0.0.1 -U hgzuqiu -d hgzuqiu < backup.sql
```

#### Git ç®¡ç†
```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æŸ¥çœ‹çŠ¶æ€
git status

# æäº¤ä»£ç 
git add .
git commit -m "feat: æ–°åŠŸèƒ½"
git push origin main
```

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-10-27
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ


