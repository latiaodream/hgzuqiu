# æœåŠ¡å™¨æ›´æ–°æŒ‡å— - é™é¢è‡ªåŠ¨è·å–åŠŸèƒ½

## ğŸ¯ æ›´æ–°å†…å®¹

æœ¬æ¬¡æ›´æ–°æ·»åŠ äº†**è´¦å·é™é¢è‡ªåŠ¨è·å–åŠŸèƒ½**ï¼š
- âœ… æ–°å¢è´¦å·æ—¶è‡ªåŠ¨ä»çš‡å† ç½‘ç«™è·å–é™é¢
- âœ… ç¼–è¾‘è´¦å·æ—¶å¯ä»¥æ‰‹åŠ¨è·å–é™é¢
- âœ… è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“
- âœ… å‹å¥½çš„ç”¨æˆ·æç¤º

## ğŸ–¥ï¸ æœåŠ¡å™¨ä¿¡æ¯

- **æœåŠ¡å™¨IP**: 47.238.112.207
- **ç”¨æˆ·å**: root
- **å¯†ç **: latiao@2025
- **é¡¹ç›®ç›®å½•**: /www/wwwroot/aibcbot.top
- **è®¿é—®åœ°å€**: https://aibcbot.top

## ğŸš€ æ›´æ–°æ­¥éª¤

### æ–¹æ³• 1: ä¸€é”®æ›´æ–°ï¼ˆæ¨èï¼‰â­

#### æ­¥éª¤ 1: è¿æ¥æœåŠ¡å™¨

```bash
ssh root@47.238.112.207
# è¾“å…¥å¯†ç : latiao@2025
```

#### æ­¥éª¤ 2: è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /www/wwwroot/aibcbot.top
```

#### æ­¥éª¤ 3: è¿è¡Œæ›´æ–°è„šæœ¬

```bash
bash server-update.sh
```

**å°±è¿™ä¹ˆç®€å•ï¼** è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
1. âœ… å¤‡ä»½å½“å‰ä»£ç 
2. âœ… æ‹‰å–æœ€æ–°ä»£ç 
3. âœ… å®‰è£…åç«¯ä¾èµ–
4. âœ… ç¼–è¯‘åç«¯ä»£ç 
5. âœ… é‡å¯åç«¯æœåŠ¡
6. âœ… æ›´æ–°å‰ç«¯ä»£ç 
7. âœ… é‡å¯ Nginx
8. âœ… è¿è¡ŒåŠŸèƒ½æµ‹è¯•
9. âœ… æ˜¾ç¤ºæœåŠ¡çŠ¶æ€

### æ–¹æ³• 2: æ‰‹åŠ¨æ›´æ–°

å¦‚æœä½ æƒ³æ‰‹åŠ¨æ§åˆ¶æ¯ä¸€æ­¥ï¼š

#### 1. è¿æ¥æœåŠ¡å™¨

```bash
ssh root@47.238.112.207
```

#### 2. è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /www/wwwroot/aibcbot.top
```

#### 3. å¤‡ä»½å½“å‰ä»£ç ï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
tar -czf backup-$(date +%Y%m%d-%H%M%S).tar.gz backend frontend
```

#### 4. æ‹‰å–æœ€æ–°ä»£ç 

```bash
git pull origin main
```

**é¢„æœŸè¾“å‡º**ï¼š
```
remote: Enumerating objects: 39, done.
remote: Counting objects: 100% (39/39), done.
Updating b199e02..2969eac
Fast-forward
 backend/src/routes/crown-automation.ts           | 65 ++++++++++
 backend/src/services/crown-automation.ts         | 162 +++++++++++++++++++++++
 ...
 12 files changed, 2138 insertions(+)
```

#### 5. æ›´æ–°åç«¯

```bash
cd backend
npm install
npm run build
```

#### 6. é‡å¯åç«¯æœåŠ¡

```bash
/www/server/nodejs/v22.18.0/bin/pm2 restart bclogin-backend
```

#### 7. æ›´æ–°å‰ç«¯

```bash
cd ../frontend
npm install
npm run build
```

#### 8. é‡å¯ Nginx

```bash
nginx -s reload
```

#### 9. æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
/www/server/nodejs/v22.18.0/bin/pm2 status
```

#### 10. æŸ¥çœ‹æ—¥å¿—

```bash
/www/server/nodejs/v22.18.0/bin/pm2 logs bclogin-backend --lines 20
```

### æ–¹æ³• 3: å¿«é€Ÿå‘½ä»¤ï¼ˆä¸€è¡Œæå®šï¼‰

```bash
cd /www/wwwroot/aibcbot.top && \
git pull origin main && \
cd backend && npm install && npm run build && \
/www/server/nodejs/v22.18.0/bin/pm2 restart bclogin-backend && \
cd ../frontend && npm install && npm run build && \
nginx -s reload && \
/www/server/nodejs/v22.18.0/bin/pm2 logs bclogin-backend --lines 20 --nostream
```

## âœ… éªŒè¯æ›´æ–°

### 1. æ£€æŸ¥ä»£ç ç‰ˆæœ¬

```bash
cd /www/wwwroot/aibcbot.top
git log --oneline -1
```

åº”è¯¥æ˜¾ç¤ºï¼š
```
2969eac docs: æ·»åŠ éƒ¨ç½²å’Œæ›´æ–°æŒ‡å—
```

### 2. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
/www/server/nodejs/v22.18.0/bin/pm2 status
```

åº”è¯¥æ˜¾ç¤º `bclogin-backend` çŠ¶æ€ä¸º `online`

### 3. æµ‹è¯•åç«¯åŠŸèƒ½

```bash
cd /www/wwwroot/aibcbot.top/backend
node backend/test-fetch-limits.js
```

åº”è¯¥æ˜¾ç¤ºï¼š
```
ğŸ§ª å¼€å§‹æµ‹è¯•é™é¢è·å–åŠŸèƒ½...
âœ… ç™»å½•æˆåŠŸ
âœ… é™é¢é¡µé¢è·å–æˆåŠŸ
âœ… æ‰¾åˆ°è¶³çƒé™é¢è¡¨æ ¼
âœ… æ‰¾åˆ°ç¯®çƒé™é¢è¡¨æ ¼
âœ… æµ‹è¯•å®Œæˆï¼é™é¢è·å–åŠŸèƒ½æ­£å¸¸å·¥ä½œ
```

### 4. æµ‹è¯•å‰ç«¯åŠŸèƒ½

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® https://aibcbot.top
2. ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•ï¼š
   - ç”¨æˆ·å: zhuren
   - å¯†ç : 123456
3. è¿›å…¥"è´¦å·ç®¡ç†"é¡µé¢
4. ç‚¹å‡»"æ·»åŠ è´¦å·"
5. å¡«å†™è´¦å·ä¿¡æ¯å¹¶ä¿å­˜
6. è§‚å¯Ÿæ˜¯å¦æ˜¾ç¤º"æ­£åœ¨è‡ªåŠ¨è·å–é™é¢ä¿¡æ¯..."
7. éªŒè¯æ˜¯å¦æ˜¾ç¤º"é™é¢ä¿¡æ¯å·²è‡ªåŠ¨è·å–å¹¶ä¿å­˜"

## ğŸ” æŸ¥çœ‹æ—¥å¿—

### å®æ—¶æŸ¥çœ‹åç«¯æ—¥å¿—

```bash
/www/server/nodejs/v22.18.0/bin/pm2 logs bclogin-backend --follow
```

æŒ‰ `Ctrl+C` é€€å‡º

### æŸ¥çœ‹æœ€è¿‘ 50 è¡Œæ—¥å¿—

```bash
/www/server/nodejs/v22.18.0/bin/pm2 logs bclogin-backend --lines 50 --nostream
```

### åªæŸ¥çœ‹é”™è¯¯æ—¥å¿—

```bash
/www/server/nodejs/v22.18.0/bin/pm2 logs bclogin-backend --err --lines 50
```

### æŸ¥çœ‹ Nginx æ—¥å¿—

```bash
# è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log

# é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: git pull å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
error: Your local changes to the following files would be overwritten by merge
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä¿å­˜æœ¬åœ°ä¿®æ”¹
git stash

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# æ¢å¤æœ¬åœ°ä¿®æ”¹ï¼ˆå¦‚æœéœ€è¦ï¼‰
git stash pop
```

### é—®é¢˜ 2: npm install å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
npm ERR! code ECONNREFUSED
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…é™¤ç¼“å­˜
npm cache clean --force

# åˆ é™¤ node_modules
rm -rf node_modules package-lock.json

# é‡æ–°å®‰è£…
npm install
```

### é—®é¢˜ 3: ç¼–è¯‘å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
error TS2307: Cannot find module
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# åˆ é™¤ç¼–è¯‘è¾“å‡º
rm -rf dist

# é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install

# é‡æ–°ç¼–è¯‘
npm run build
```

### é—®é¢˜ 4: PM2 é‡å¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
[PM2] Process not found
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
/www/server/nodejs/v22.18.0/bin/pm2 list

# å¦‚æœæ²¡æœ‰è¿›ç¨‹ï¼Œé‡æ–°å¯åŠ¨
cd /www/wwwroot/aibcbot.top/backend
/www/server/nodejs/v22.18.0/bin/pm2 start npm --name "bclogin-backend" -- run start
```

### é—®é¢˜ 5: Nginx é‡å¯å¤±è´¥

**é”™è¯¯ä¿¡æ¯**ï¼š
```
nginx: [error] invalid PID number
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æµ‹è¯•é…ç½®
nginx -t

# å¦‚æœé…ç½®æ­£ç¡®ï¼Œå¼ºåˆ¶é‡å¯
systemctl restart nginx
```

### é—®é¢˜ 6: é™é¢è·å–å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
1. è´¦å·å¯†ç é”™è¯¯
2. çš‡å† ç½‘ç«™æ— æ³•è®¿é—®
3. ç½‘ç»œè¿æ¥é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æµ‹è¯•ç½‘ç»œè¿æ¥
curl https://hga038.com

# 2. è¿è¡Œæµ‹è¯•è„šæœ¬
cd /www/wwwroot/aibcbot.top/backend
node backend/test-fetch-limits.js

# 3. æŸ¥çœ‹åç«¯æ—¥å¿—
/www/server/nodejs/v22.18.0/bin/pm2 logs bclogin-backend --lines 50
```

## ğŸ”„ å›æ»šæ­¥éª¤

å¦‚æœæ›´æ–°åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å›æ»šï¼š

### æ–¹æ³• 1: ä½¿ç”¨å¤‡ä»½æ–‡ä»¶

```bash
cd /www/wwwroot/aibcbot.top

# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
ls -lh backup-*.tar.gz

# è§£å‹å¤‡ä»½ï¼ˆæ›¿æ¢ä¸ºå®é™…çš„å¤‡ä»½æ–‡ä»¶åï¼‰
tar -xzf backup-20251028-143000.tar.gz

# é‡æ–°ç¼–è¯‘
cd backend
npm run build

# é‡å¯æœåŠ¡
/www/server/nodejs/v22.18.0/bin/pm2 restart bclogin-backend
```

### æ–¹æ³• 2: ä½¿ç”¨ Git å›æ»š

```bash
cd /www/wwwroot/aibcbot.top

# æŸ¥çœ‹æäº¤å†å²
git log --oneline -10

# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
git reset --hard b199e02

# é‡æ–°ç¼–è¯‘
cd backend
npm run build

# é‡å¯æœåŠ¡
/www/server/nodejs/v22.18.0/bin/pm2 restart bclogin-backend
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹æœåŠ¡å™¨èµ„æº

```bash
# æŸ¥çœ‹ç£ç›˜ç©ºé—´
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ CPU ä½¿ç”¨
top

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep node
```

### å®šæœŸç»´æŠ¤

```bash
# æ¸…ç†æ—§çš„å¤‡ä»½æ–‡ä»¶ï¼ˆä¿ç•™æœ€è¿‘ 5 ä¸ªï¼‰
cd /www/wwwroot/aibcbot.top
ls -t backup-*.tar.gz | tail -n +6 | xargs rm -f

# æ¸…ç† PM2 æ—¥å¿—
/www/server/nodejs/v22.18.0/bin/pm2 flush

# æ¸…ç† npm ç¼“å­˜
npm cache clean --force
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| `SERVER_CONFIG.md` | æœåŠ¡å™¨é…ç½®ä¿¡æ¯ |
| `QUICK_REFERENCE_LIMITS.md` | å¿«é€Ÿå‚è€ƒæŒ‡å— |
| `DEPLOYMENT_GUIDE.md` | è¯¦ç»†éƒ¨ç½²æŒ‡å— |
| `TEST_FETCH_LIMITS.md` | æµ‹è¯•æŒ‡å— |

## ğŸ‰ æ›´æ–°å®Œæˆ

æ›´æ–°å®Œæˆåï¼Œä½ çš„ç³»ç»Ÿå°†æ‹¥æœ‰ï¼š

âœ… **è‡ªåŠ¨åŒ–**: æ–°å¢è´¦å·æ—¶è‡ªåŠ¨è·å–é™é¢  
âœ… **ä¾¿æ·æ€§**: ç¼–è¾‘è´¦å·æ—¶ä¸€é”®æ›´æ–°é™é¢  
âœ… **å‡†ç¡®æ€§**: ç›´æ¥ä»çš‡å† ç½‘ç«™è·å–æœ€æ–°æ•°æ®  
âœ… **å‹å¥½æ€§**: æ¸…æ™°çš„æç¤ºå’Œé”™è¯¯å¤„ç†  

ç°åœ¨å¯ä»¥è®¿é—® https://aibcbot.top ä½¿ç”¨æ–°åŠŸèƒ½äº†ï¼

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-28  
**ç‰ˆæœ¬**: v1.0.0  
**æœåŠ¡å™¨**: 47.238.112.207  
**é¡¹ç›®ç›®å½•**: /www/wwwroot/aibcbot.top

